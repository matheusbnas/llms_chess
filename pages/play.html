<link rel="stylesheet" href="/css/chessboard.css">

<!-- ♟️ Play Page - Corrigida com Tabuleiro Profissional -->
<div class="text-center mb-24">
    <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 8px;">
        <i class="fas fa-gamepad" style="color: var(--lichess-brown-light);"></i>
        Jogar contra IA
    </h1>
    <p style="color: var(--text-secondary); font-size: 16px;">
        Desafie um modelo de IA em uma partida de xadrez profissional
    </p>
</div>

<!-- Game Layout -->
<div class="d-grid" style="grid-template-columns: 300px 1fr 300px; gap: 24px; align-items: start;">
    
    <!-- Left Sidebar - Game Configuration -->
    <div class="d-flex" style="flex-direction: column; gap: 16px;">
        <!-- Game Setup -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-cog"></i>
                    Nova Partida
                </h3>
            </div>
            
            <div class="form-group">
                <label class="form-label">Oponente IA</label>
                <select class="form-control" id="opponent-model">
                    <option value="GPT-4o">GPT-4o (Mais Forte)</option>
                    <option value="GPT-4-Turbo">GPT-4-Turbo (Equilibrado)</option>
                    <option value="Gemini-Pro" selected>Gemini-Pro (Criativo)</option>
                    <option value="Claude-3.5-Sonnet">Claude-3.5 (Estratégico)</option>
                    <option value="Deepseek-R1">Deepseek-R1 (Experimental)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Sua Cor</label>
                <div class="d-flex gap-8">
                    <label class="form-check" style="flex: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; text-align: center;">
                        <input type="radio" name="player-color" value="white" checked style="margin-right: 8px;">
                        <span style="font-size: 16px;">♔</span>
                        <span class="form-check-label">Brancas</span>
                    </label>
                    <label class="form-check" style="flex: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; text-align: center;">
                        <input type="radio" name="player-color" value="black" style="margin-right: 8px;">
                        <span style="font-size: 16px;">♚</span>
                        <span class="form-check-label">Pretas</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Dificuldade</label>
                <select class="form-control" id="difficulty">
                    <option value="beginner">Iniciante (1200)</option>
                    <option value="intermediate">Intermediário (1400)</option>
                    <option value="advanced" selected>Avançado (1600)</option>
                    <option value="expert">Expert (1800)</option>
                    <option value="master">Mestre (2000+)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Controle de Tempo</label>
                <select class="form-control" id="time-control">
                    <option value="unlimited">Sem limite</option>
                    <option value="bullet">Bullet (1+0)</option>
                    <option value="blitz" selected>Blitz (5+3)</option>
                    <option value="rapid">Rapid (15+10)</option>
                    <option value="classical">Classical (30+0)</option>
                </select>
            </div>

            <button class="btn btn-primary" style="width: 100%; justify-content: center; padding: 12px;" onclick="startNewHumanGame()">
                <i class="fas fa-play"></i>
                Iniciar Partida
            </button>
        </div>

        <!-- Game Controls -->
        <div class="card" id="game-controls-card" style="display: none;">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-tools"></i>
                    Controles
                </h3>
            </div>
            
            <div class="d-flex" style="flex-direction: column; gap: 8px;">
                <button class="btn btn-secondary" style="justify-content: center;" onclick="requestHint()" id="hint-btn">
                    <i class="fas fa-lightbulb"></i>
                    Solicitar Dica
                </button>
                <button class="btn btn-secondary" style="justify-content: center;" onclick="undoMove()" id="undo-btn">
                    <i class="fas fa-undo"></i>
                    Desfazer Lance
                </button>
                <button class="btn btn-warning" style="justify-content: center;" onclick="offerDraw()" id="draw-btn">
                    <i class="fas fa-handshake"></i>
                    Oferecer Empate
                </button>
                <button class="btn btn-danger" style="justify-content: center;" onclick="resignGame()" id="resign-btn">
                    <i class="fas fa-flag"></i>
                    Resignar
                </button>
            </div>
        </div>
    </div>

    <!-- Center - Game Board -->
    <div class="d-flex" style="flex-direction: column; align-items: center; gap: 16px;">
        <!-- Game Status -->
        <div id="game-status" class="game-status status-playing" style="width: 100%; max-width: 512px;">
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">
                <i class="fas fa-info-circle"></i>
                Configure uma nova partida para começar
            </div>
            <div style="color: var(--text-secondary); font-size: 14px;">
                Selecione seu oponente e configurações acima
            </div>
        </div>
        
        <!-- Professional Chess Board -->
        <div class="chessboard-wrapper">
            <div class="chessboard-container" id="play-chessboard-container">
                <!-- Coordenadas externas -->
                <div class="coordinates-external coord-files-top">
                    <div class="coord-label">a</div>
                    <div class="coord-label">b</div>
                    <div class="coord-label">c</div>
                    <div class="coord-label">d</div>
                    <div class="coord-label">e</div>
                    <div class="coord-label">f</div>
                    <div class="coord-label">g</div>
                    <div class="coord-label">h</div>
                </div>
                
                <div class="coordinates-external coord-ranks-left">
                    <div class="coord-label">8</div>
                    <div class="coord-label">7</div>
                    <div class="coord-label">6</div>
                    <div class="coord-label">5</div>
                    <div class="coord-label">4</div>
                    <div class="coord-label">3</div>
                    <div class="coord-label">2</div>
                    <div class="coord-label">1</div>
                </div>
                
                <!-- Tabuleiro principal -->
                <div class="chessboard" id="play-chessboard">
                    <!-- As 64 casas serão geradas por JavaScript -->
                </div>
                
                <div class="coordinates-external coord-ranks-right">
                    <div class="coord-label">8</div>
                    <div class="coord-label">7</div>
                    <div class="coord-label">6</div>
                    <div class="coord-label">5</div>
                    <div class="coord-label">4</div>
                    <div class="coord-label">3</div>
                    <div class="coord-label">2</div>
                    <div class="coord-label">1</div>
                </div>
                
                <div class="coordinates-external coord-files-bottom">
                    <div class="coord-label">a</div>
                    <div class="coord-label">b</div>
                    <div class="coord-label">c</div>
                    <div class="coord-label">d</div>
                    <div class="coord-label">e</div>
                    <div class="coord-label">f</div>
                    <div class="coord-label">g</div>
                    <div class="coord-label">h</div>
                </div>
            </div>
        </div>

        <!-- Board Controls -->
        <div class="board-controls" id="board-controls" style="display: none;">
            <button class="control-btn" title="Primeiro lance" onclick="goToMove('first')">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn" title="Lance anterior" onclick="goToMove('previous')">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="control-btn" title="Próximo lance" onclick="goToMove('next')">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="control-btn" title="Último lance" onclick="goToMove('last')">
                <i class="fas fa-step-forward"></i>
            </button>
            <button class="control-btn" title="Virar tabuleiro" onclick="flipPlayBoard()">
                <i class="fas fa-refresh"></i>
            </button>
        </div>
        
        <!-- Theme Selector -->
        <div class="theme-selector" style="display: none;">
            <span class="theme-label">Tema:</span>
            <div class="theme-option brown active" onclick="changePlayTheme('brown')" title="Tema Marrom (Lichess)"></div>
            <div class="theme-option blue" onclick="changePlayTheme('blue')" title="Tema Azul"></div>
            <div class="theme-option green" onclick="changePlayTheme('green')" title="Tema Verde"></div>
        </div>
    </div>

    <!-- Right Sidebar - Game Info -->
    <div class="d-flex" style="flex-direction: column; gap: 16px;">
        <!-- Player Info -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-users"></i>
                    Jogadores
                </h3>
            </div>
            
            <div style="margin-bottom: 16px;">
                <div class="d-flex align-center gap-12">
                    <div style="width: 40px; height: 40px; background: var(--bg-tertiary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">Você</div>
                        <div style="color: var(--text-secondary); font-size: 12px;" id="player-color-display">Brancas</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; font-weight: 600;" id="player-rating">1600</div>
                        <div style="color: var(--text-secondary); font-size: 10px;">Rating</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 12px 0; color: var(--text-muted); font-weight: 600;">VS</div>
            
            <div>
                <div class="d-flex align-center gap-12">
                    <div style="width: 40px; height: 40px; background: var(--lichess-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;" id="ai-model-display">Gemini-Pro</div>
                        <div style="color: var(--text-secondary); font-size: 12px;" id="ai-color-display">Pretas</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; font-weight: 600;" id="ai-rating">1750</div>
                        <div style="color: var(--text-secondary); font-size: 10px;">Rating</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clock -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-clock"></i>
                    Tempo
                </h3>
                <span class="badge badge-secondary" id="time-control-display">Blitz 5+3</span>
            </div>
            
            <div class="d-flex justify-between align-center">
                <div style="text-align: center; flex: 1;">
                    <div style="font-size: 24px; font-weight: 700; font-family: var(--font-mono); color: var(--lichess-green);" id="player-time">5:00</div>
                    <div style="color: var(--text-secondary); font-size: 12px;">Você</div>
                </div>
                <div style="color: var(--text-muted); font-size: 20px;">:</div>
                <div style="text-align: center; flex: 1;">
                    <div style="font-size: 24px; font-weight: 700; font-family: var(--font-mono); color: var(--text-muted);" id="ai-time">5:00</div>
                    <div style="color: var(--text-secondary); font-size: 12px;">IA</div>
                </div>
            </div>
        </div>

        <!-- Move History -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-history"></i>
                    Lances
                </h3>
                <button class="btn btn-sm btn-secondary" onclick="exportGamePGN()">
                    <i class="fas fa-download"></i>
                    PGN
                </button>
            </div>
            
            <div id="move-history" style="max-height: 200px; overflow-y: auto; font-family: var(--font-mono); font-size: 13px;">
                <div style="color: var(--text-muted); text-align: center; padding: 20px; font-style: italic;">
                    Nenhuma partida em andamento
                </div>
            </div>
        </div>

        <!-- Analysis -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Análise
                </h3>
            </div>
            
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="width: 20px; height: 80px; background: linear-gradient(to top, #2c2c2c 50%, #eeeeee 50%); border: 1px solid var(--border-color); border-radius: 3px; position: relative;">
                    <div id="eval-indicator" style="position: absolute; width: 100%; height: 3px; background: var(--lichess-blue); top: 50%; transform: translateY(-50%); border-radius: 1px;"></div>
                </div>
                <div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--text-primary);" id="evaluation">+0.0</div>
                    <div style="color: var(--text-secondary); font-size: 12px;">Avaliação</div>
                </div>
            </div>
            
            <div style="font-size: 12px; color: var(--text-secondary);">
                <div>Melhor lance: <span style="font-family: var(--font-mono); color: var(--text-primary);" id="best-move">-</span></div>
                <div>Profundidade: <span id="engine-depth">-</span></div>
            </div>
        </div>

        <div style="font-size: 14px; font-weight: 600;">Histórico de Lances</div>
        <div class="pgn-container" id="play-pgn-container">
            A partida ainda não começou...
        </div>
    </div>
</div>